[build]
  builder = "NIXPACKS"
  buildCommand = "python -m pip install --upgrade pip && pip install -r requirements.txt"
  publish = "staticfiles"

[deploy]
  startCommand = "python manage.py migrate --noinput && python manage.py collectstatic --noinput && gunicorn --workers 2 --bind 0.0.0.0:$PORT --timeout 300 --access-logfile - --error-logfile - mascotas_perdidas.wsgi:application"
  healthcheckPath = "/"
  healthcheckTimeout = 300  # 5 minutos de espera para el healthcheck
  restartDelay = 60  # Aumentar el tiempo de espera entre reinicios
  restartMax = 5
  restartTimeout = 300
  restartWindow = 600
  zeroDowntime = false

[build.environment]
  PYTHONUNBUFFERED = "1"
  PYTHONPATH = "/app"
  PYTHON_VERSION = "3.11.4"
  NODE_VERSION = "18"

[deploy.environment]
  # Configuración de Django
  DEBUG = "True"  # Temporalmente en True para depuración
  DJANGO_SETTINGS_MODULE = "mascotas_perdidas.settings"
  SECRET_KEY = "your-secret-key-here"  # Asegúrate de reemplazarlo con una clave segura
  ALLOWED_HOSTS = "*"
  CSRF_TRUSTED_ORIGINS = "https://*.railway.app"
  
  # Configuración de la base de datos
  # La URL de la base de datos será proporcionada automáticamente por Railway
  
  # Configuración de logs
  PYTHONUNBUFFERED = "1"
  PYTHONDONTWRITEBYTECODE = "1"
  
  # Puerto
  PORT = "8000"
  
  # Configuración de WhiteNoise
  STATICFILES_STORAGE = "whitenoise.storage.CompressedManifestStaticFilesStorage"
  
  # Configuración de la base de datos
  DATABASE_URL = "${DATABASE_URL}"
  
  # Configuración de Gunicorn
  GUNICORN_CMD_ARGS = "--workers=2 --timeout=300 --bind=0.0.0.0:$PORT --access-logfile - --error-logfile -"
  
  # Configuración de Python
  PYTHONPATH = "/app"
  PYTHONUNBUFFERED = "1"
  PYTHONDONTWRITEBYTECODE = "1"
  
  # Configuración de la aplicación
  DJANGO_SETTINGS_MODULE = "mascotas_perdidas.settings"
  
  # Configuración de seguridad (temporalmente deshabilitada para depuración)
  SECURE_SSL_REDIRECT = "False"
  SESSION_COOKIE_SECURE = "False"
  CSRF_COOKIE_SECURE = "False"
